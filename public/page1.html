<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>WebPackalackin</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script
    src="http://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" href="http://kendo.cdn.telerik.com/2018.1.117/styles/kendo.common.min.css" />
</head>
<body>

    <h1>day I'm bundling...</h1>
    <input id="datePicker" />
    <script src="Built/main.bundle.js"></script>
    <script src=" http://kendo.cdn.telerik.com/2018.1.117/js/kendo.all.min.js"></script>
</body>
</html> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /> -->
<link rel="stylesheet" href="http://kendo.cdn.telerik.com/2018.1.117/styles/kendo.common.min.css" />
<script src=" http://kendo.cdn.telerik.com/2018.1.117/js/kendo.all.min.js"></script>
<style>
    .k-grid td:first-child,
    .k-grid .k-header tr th:first-child {
        text-align: left;
    }

    .k-grid .k-checkbox-label.k-no-text {
        padding: 0;
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.js"></script>
<div class="row">
    <div class="row">
        <div class="col-lg-6">
            <div class="headerPage">
                <h2></h2>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12 scbam-content">

            <span id="popupNotification"></span>
            <form id="paymentDetailForm" class="form-horizontal form-widgets">


                <div id="detailForm">


                    <div class="form-group ">
                        <div class="col-md-6 col-lg-6">
                            <div>
                                <label for="Expense_Code_Grp">Expense Code </label>
                            </div>
                            <input id="Expense_Code_Grp" style="width: 50%;" />

                        </div>

                    </div>

                    <div class="form-group ">
                        <div class="col-md-6 col-lg-6">
                            <h3>Trade Date</h3>
                            <div class="form-group ">
                                <div class="col-md-6 col-lg-4">
                                    <div>
                                        <label for="TradeStrDate">Start Date </label>
                                    </div>
                                    <input id='TradeStrDate' maxlength="100" style="width:100%" />
                                </div>
                                <div class="col-md-6 col-lg-4">
                                    <div>
                                        <label for="TradeEndDate">End Date </label>
                                    </div>
                                    <input id='TradeEndDate' maxlength="100" style="width:100%" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-6">
                            <h3>Settle Date</h3>
                            <div class="form-group ">
                                <div class="col-md-6 col-lg-4">
                                    <div>
                                        <label for="SettleStrDate">Start Date </label>
                                    </div>
                                    <input id='SettleStrDate' maxlength="15" style="width:100%" />
                                </div>
                                <div class="col-md-6 col-lg-4">
                                    <div>
                                        <label for="SettleEndDate">End Date </label>
                                    </div>
                                    <input id="SettleEndDate" maxlength="15" style="width:100%" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </form>

            <button class="btn col-lg-1 btn-primary" id='search' type="submit">Search</button>

        </div>

    </div>

    <div class="row">
        <div class="form-group displayGrid">

            <div id="gridPaymentTransaction"></div>
            <div class="col-lg-12" style="margin-top:1%">

                <button class="btn maker col-lg-1 " id='import'>IMPORT</button>
                <button class="btn maker col-lg-1 " id='import-merge' style="margin-left:1%">IMPORT MERGE</button>
            </div>


        </div>
    </div>


</div>

<script type="text/javascript">
    var item_select = []
    var dataSourceResultSearch;
    window.record = 0
    var oldPageSize = 0;
    var dataItemAll = 'N'
    var lastpage = 1;

    // kendoWidget()
    // tradeDatePickerView()
    // settleDatePickerView()


    $("#search").click(function () {
        resultDetailGrid()
        // var linkService = url + '/ImpETSData'
        // $.post(linkService, {

        //     UserName: localStorage.getItem("userID"),
        //     AppTokenId: getCookie("tokenAppId"),
        //     ExpCode: $("#Expense_Code_Grp").data("kendoDropDownList").value(), //EXP-00014
        //     ReqData: "",
        //     SettleStr: moment($("#SettleStrDate").data("kendoDatePicker").value()).format("YYYY-MM-DDT00:00:00"), //2018-01 - 01T00: 00:00
        //     SettleEnd: moment($("#SettleEndDate").data("kendoDatePicker").value()).format("YYYY-MM-DDT00:00:00"), //2018-01 - 01T00: 00:00,
        //     TradeStr: moment($("#TradeStrDate").data("kendoDatePicker").value()).format("YYYY-MM-DDT00:00:00"), //2018-01 - 01T00: 00:00
        //     TradeEnd: moment($("#TradeEndDate").data("kendoDatePicker").value()).format("YYYY-MM-DDT00:00:00"), //2018-01 - 01T00: 00:00
        //     TypeOfData: "SCH"

        // }, function getResult(response) {
        //     console.log(response)
        //     if (response.status.code == '200') {
        //         dataSourceResultSearch = response.data;

        //         resultDetailGrid(dataSourceResultSearch)
        //     } else {
        //         // error status != 200
        //     }

        // })
    })


    if (oldPageSize == 0) { oldPageSize = 20; }
    function resultDetailGrid(dataSource, optionsJSON) {
        console.log("dataSource : ", dataSource)
        dataSource = [{
            ActImp: true
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: true
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: true
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: true
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: true
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: true
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: true
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: true
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: false
        }, {
            ActImp: true
        }, {
            ActImp: false
        }]
        var dataSourceResult = new kendo.data.DataSource({
            data: dataSource,

            schema: {
                model: {
                    id: "TF_Id",
                    fields: {

                        ActImp: { type: "boolean" },
                        Exp_Code_ETS: { type: "string" },
                        Exp_Code_Source: { type: "string" },
                        Exp_Desc_En_ETS: { type: "string" },
                        Exp_Desc_Th_ETS: { type: "string" },
                        FundCode: { type: "string" },
                        GrossAmt: { type: "number" },
                        LastImpDT: { type: "date" },
                        PT_Source: { type: "string" },
                        PYM_Fund_AccNo: { type: "string" },
                        PYM_Fund_AccType: { type: "string" },
                        PYM_Fund_Bank: { type: "string" },
                        PYM_Fund_Branch: { type: "string" },
                        PYM_Fund_Custodian: { type: "string" },
                        PYM_Method: { type: "string" },
                        Payee_AccBank: { type: "string" },
                        Payee_AccBankBranch: { type: "string" },
                        Payee_AccNo: { type: "string" },
                        Payee_AccType: { type: "string" },
                        Payee_ETS: { type: "string" },
                        Payee_ETS_Name_En: { type: "string" },
                        Payee_ETS_Name_Th: { type: "string" },
                        Payee_Source: { type: "string" },
                        SettleDate: { type: "date" },
                        SubFundCode: { type: "string" },
                        TF_Id: { type: "number" },
                        TF_ImpStatus: { type: "string" },
                        TF_ImpType: { type: "string" },
                        TotalAmt: { type: "number" },
                        TradeDate: { type: "date" },
                        VatAmt: { type: "number" },
                        VatRate: { type: "number" },
                        WTAmt: { type: "number" },
                        WTRate: { type: "number" },
                    }
                }
            },
            aggregate: [
                { field: "GrossAmt", aggregate: "sum" },
                { field: "VatAmt", aggregate: "sum" },
                { field: "TotalAmt", aggregate: "sum" },
                { field: "WTAmt", aggregate: "sum" },
                { field: "SettleAmt", aggregate: "sum" }

            ],
            //pageSize: 30,
            pageSize: oldPageSize,
            page: lastpage,
            //page: 1,
        });

        $("#gridPaymentTransaction").kendoGrid({
            dataSource: dataSourceResult,
            columns: [
                {
                    field: "ActImp",
                    width: 120,
                    template: "<input type='checkbox' data-bind='checked:dirty' />",
                    headerTemplate: "<input id='checkAll' type='checkbox' onclick='checkAll(this)'/>"
                },

                // {
                //     field: "ActImp",
                //     title: "All",
                //     columns: [{
                //         selectable: true,
                //         width: 40
                //     }]
                // },

                {
                    title: "No",
                    template: "#= ++record #",
                    width: 80,
                    sortable: false,
                },


                {
                    title: "Payee Code",
                    columns: [{
                        field: "Payee_Source",
                        title: "Source",
                        width: 200
                    }, {
                        field: "Payee_ETS",
                        title: "ETS",
                        width: 200
                    }],
                    //    width: 300
                },
                {
                    title: "Method",
                    field: "PYM_Method",
                    width: 130
                },
                {
                    title: "Payee Bank Ac No",
                    columns: [{
                        field: "Payee_AccBank",
                        title: "Bank",
                        width: 100
                    }, {
                        field: "Payee_AccBankBranch",
                        title: "Branch",
                        width: 100
                    },
                    {
                        field: "Payee_AccType",
                        title: "Type",
                        width: 100
                    },
                    {
                        title: "No",
                        field: "Payee_AccNo",
                        width: 120
                    }]
                },
                { field: "Exp_Code_ETS", title: "Expense Code", width: 120 },
                {
                    title: "Expense Code",
                    columns: [{
                        field: "Exp_Code_Source",
                        title: "Source",
                        width: 200
                    }, {
                        field: "Exp_Code_ETS",
                        title: "ETS",
                        width: 200
                    }],
                    // width: 300
                },


                {
                    field: "Exp_Desc_En_ETS",
                    title: "Expense Name En",
                    width: 300
                },
                {
                    field: "TradeDate", title: "TradeDate",
                    width: 150,
                    template: '#= (TradeDate != null ) ? kendo.toString(kendo.parseDate(TradeDate), "dd/MM/yyyy") : "" #',
                },
                {
                    field: "SettleDate", title: "SettleDate",
                    width: 150,
                    template: '#= (SettleDate != null ) ? kendo.toString(kendo.parseDate(SettleDate), "dd/MM/yyyy") : "" #',
                },
                {
                    field: "FundCode",
                    template: (function (dataItem) {
                        var Fund_Code = "";
                        var Sub_Fund_Code = "";
                        var full_Fund_Code = "";
                        Fund_Code = dataItem.FundCode;
                        if (dataItem.SubFundCode != null) {
                            full_Fund_Code = Fund_Code + " : " + dataItem.SubFundCode
                        } else {
                            full_Fund_Code = Fund_Code
                        }
                        return "<div style='text-align:left'>" + full_Fund_Code + "</div>";
                    }),
                    width: 150
                },
                {
                    title: "Custodian Bank Ac No",
                    columns: [{
                        field: "PYM_Fund_Bank",
                        title: "Bank",
                        width: 100
                    },
                    {
                        field: "PYM_Fund_AccType",
                        title: "Type",
                        width: 100
                    }, {
                        title: "No",
                        field: "PYM_Fund_AccNo",
                        width: 120,
                        footerTemplate: "<span style='float:right'> Total: </span>"
                    }]
                },
                {
                    field: "GrossAmt", title: "GrossAmt",
                    template: "<span style='float:right'>#=kendo.toString(GrossAmt, 'n')  #</span>",
                    width: 120,
                    aggregates: ["sum"],
                    footerTemplate: " #=kendo.toString(sum, 'n')  #"
                },
                {
                    field: "VatAmt",
                    title: "VatAmt",
                    template: "<span style='float:right'>#=kendo.toString(VatAmt, 'n')  #</span>",
                    width: 120,
                    aggregates: ["sum"],
                    footerTemplate: " #=kendo.toString(sum, 'n')  #"
                },
                {
                    field: "TotalAmt",
                    title: "TotalAmt",
                    template: "<span style='float:right'>#=kendo.toString(TotalAmt, 'n')  #</span>",
                    width: 120,
                    aggregates: ["sum"],
                    footerTemplate: " #=kendo.toString(sum, 'n')  #"
                },
                {
                    field: "WTAmt",
                    title: "WTAmt",
                    template: "<span style='float:right'>#=kendo.toString(WTAmt, 'n')  #</span>",
                    width: 120,
                    aggregates: ["sum"],
                    footerTemplate: " #=kendo.toString(sum, 'n')  #"
                },
                {
                    field: "SettleAmt", title: "SettleAmt",
                    template: (function (dataItem) {
                        var settle_amt = "";
                        if (dataItem.SettleAmt != null) {
                            settle_amt = kendo.toString(SettleAmt, 'n')
                        } else {
                            settle_amt = ""
                        }
                        return "<div style='text-align:right'>" + settle_amt + "</div>";
                    }),
                    width: 120,
                    aggregates: ["sum"],
                    footerTemplate: " #if(sum==null){ # 0.00 #}else{ kendo.toString(sum, 'n') } #"
                },
                {
                    field: "TF_ImpStatus", title: "Status", width: 120,
                }

            ],
            dataBinding: function () {
                //set record continue
                record = (this.dataSource.page() - 1) * this.dataSource.pageSize();
            },
            dataBound: function (e) {
                // console.log(e.sender.items())
                // e.sender.items().each(function () {
                //     var dataItem = e.sender.dataItem(this);
                //     console.log('dataItem : ', dataItem)
                //     kendo.bind(this, dataItem);  //bind ค่าคืน checkbox

                //     if (dataItem.ActImp) {
                //         $(this).addClass("k-state-selected");
                //     } else {
                //         $(this).find('td').children().remove()
                //     }
                // })
                var grid = $("#gridPaymentTransaction").data("kendoGrid");
                var rows = e.sender.tbody[0].rows;
                //console.log('dataItemAll ', dataItemAll)
                $(rows).each(function (e) {

                    var row = this;
                    var dataItem = grid.dataItem(row);
                    kendo.bind(this, dataItem); 
                    if (dataItem.ActImp) {
                        $(this).addClass("k-state-selected");
                    } else {
                        $(this).find('td').children().remove()
                    }

                });

                console.log('e.sender.dataSource.view().length : ', e.sender.dataSource.view().length)
                console.log(' e.sender.items().find(":checked").length : ', e.sender.items().find(":checked").length)
                $("#checkAll")[0].checked = e.sender.items().find(":checked").length == e.sender.dataSource.view().length;
            },
            // dataBound: function (e) {
                // var grid = $("#gridPaymentTransaction").data("kendoGrid");
                // var rows = e.sender.tbody[0].rows;
                // console.log('dataItemAll ', dataItemAll)
                // $(rows).each(function (e) {

                //     var row = this;
                //     var dataItem = grid.dataItem(row);
                //     if (dataItem.ActImp == true) {
                //         console.log($(this).find('td').children())
                //         $(this).find('td').children().remove()
                //         //console.log($(this).find('td').children())
                //     }
                //     if (dataItemAll == 'Y') {
                //         console.log(' item select : ', $("#gridPaymentTransaction").data("kendoGrid").select().length)
                //     } else {
                //         console.log('select row')


                //     }

                // });



            // },
            //persistSelection: true,
            noRecords: {
                template: "No data available please search again"
            },
            pageable: {
                numeric: true,
                pageSizes: [100, 250, 500],
                previousNext: true,
                input: false,
                refresh: true
            },
            persistSelection: true,
            pageSize: oldPageSize,
        });

        var grid = $("#gridPaymentTransaction").data("kendoGrid");
        // grid.thead.on("click", ".k-checkbox", onClick);
        $("#gridPaymentTransaction").data("kendoGrid").table.on("click", ".k-checkbox", selectRow);

    }

    function checkAll(input) {
        var grid = $("#gridPaymentTransaction").data("kendoGrid");
        oldPageSize = grid.dataSource.pageSize();
        grid.dataSource.pageSize(grid.dataSource.data().length);

        var items = grid.items();
        // // console.log('press check all : ', input)
        var items = grid.dataSource.data();
        // console.log('items check all : ', items)
        for (var i = 0; i < items.length; i++) {
            console.log('items [', i, '] =  ', items[i])
            // console.log('input  =  ',input.checked)
            if (items[i].ActImp == input.checked) {
                console.log('ActImp  =  ', items[i].ActImp, 'input.checked  =  ', input.checked)
                // items[i].ActImp = input.checked;
                items[i].dirty = true;
            } else {
                dataItem.dirty = false;
            }
        }
        // items.each(function(k,v)
        // { 
        //     console.log('k : ', k , ' v : ',v)
        //  var dataItem = grid.dataItem(this);
        //  console.log('dataItem : ', dataItem)
        //     console.log('input  =  ',input.checked)
        //   if(dataItem.ActImp == input.checked){
        //     dataItem.ActImp = input.checked;
        //     dataItem.dirty = true;
        //   }else{
        //     dataItem.dirty = false;
        //   }
        // })
        grid.refresh();
        grid.dataSource.pageSize(oldPageSize);
    }

    function selectRow() {

        ////////var checked = this.checked,
        ////////    row = $(this).closest("tr"),
        ////////    grid = $("#gridPaymentTransaction").data("kendoGrid"),
        ////////    dataItem = grid.dataItem(row);
        dataItemAll = 'N'
        ////////if (checked) {
        ////////    console.log(dataItem)
        ////////    //////item_select.push({
        ////////    //////    "PT_Id": dataItem.PT_Id,
        ////////    //////    "INSH_BatchNo": dataItem.INSH_BatchNo,
        ////////    //////    "Status": dataItem.TransStatus,
        ////////    //////    "TranSubStatus": dataItem.TranSubStatus
        ////////    //////});

        ////////} else {
        ////////    //  console.log('checked false')
        ////////    var result2RemoveCheckbox = item_select.filter(function (v, i) {
        ////////        if (v.PT_Id === dataItem.PT_Id) { item_select.splice(i, 1) }
        ////////    });
        ////////    var result2RemoveTempBatch = item_select.filter(function (v, i) {
        ////////        if (v.PT_Id === dataItem.PT_Id) { item_select.splice(i, 1) }
        ////////    });
        ////////}

        ////////console.log('selected event select : ', item_select)

    }

    function onClick(e) {
        var grid = $("#gridPaymentTransaction").data("kendoGrid");
        oldPageSize = grid.dataSource.pageSize();
        grid.dataSource.pageSize(grid.dataSource.data().length);
        //console.log('e : ', grid.tbody)
        //console.log('e : ', $(e.target))
        //console.log('e : ', $(e.target).parent().parent().parent().parent().parent().parent())
        ////console.log('e : ', grid.tbody.find('tr:eq(0) td:eq(0)').is('.k-checkbox'))
        ////console.log('e : ', grid.tbody.find('tr:eq(1) td:eq(0)').is('.k-checkbox'))
        ////console.log('e : ', grid.tbody.find('tr:eq(2) td:eq(0)').is('.k-checkbox'))
        ////console.log('e : ', grid.tbody.find('tr:eq(3) td:eq(0)').is('.k-checkbox'))

        if (grid.dataSource.data().length == grid.select().length) {
            grid.clearSelection();
            dataItemAll = "N";
        } else {
            for (var i = 0; i < grid.dataSource.data().length; i++) {
                console.log('ein or  : ', grid.tbody.find('tr:eq(' + i + ') td:eq(0)').is('.k-checkbox'))
                if (grid.tbody.find('tr:eq(' + i + ') td:eq(0)').is('.k-checkbox')) {
                    //var uid = grid.dataSource.data()[i].uid
                    //grid.select("tr[data-uid='" + uid + "']");
                    console.log('can select')
                }
                ////if (grid.dataSource.data()[i].ActImp) {
                ////    //console.log(grid.dataSource.data()[i]);
                ////    ////if (grid.tbody.find('tr:eq('+i+') td:eq(0)').is('.k-checkbox')) {
                ////    //////var uid = grid.dataSource.data()[i].uid
                ////    //////grid.select("tr[data-uid='" + uid + "']");
                ////    ////    console.log('can select')
                ////    ////}
                ////}
            }
            //console.log('grid >> ', grid.select().length)
            dataItemAll = "Y";
            //  dataItemAll = "Y";
        };
        grid.dataSource.pageSize(oldPageSize);

    }


    $("#import").click(function (e) {
        //if ($('input[name=typeSearch]:checked').val() == "byBatch") {
        //    printPaymetNoBatch()
        //} else if (item_select.length > 0) {
        //    if ($('input[name=typeSearch]:checked').val() == "oth") {
        //        $('#send-approve').show()
        //    }
        //    printPaymetNoBatch()
        //} else {
        //    createNotification(" Plase Select data ", "error")
        //}
        lastpage = $("#gridPaymentTransaction").data("kendoGrid").dataSource.page();
        console.log(' import click ', lastpage)
    })



</script>
